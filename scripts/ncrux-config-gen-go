#!/bin/bash

#
# Copyright (C) 2016 nCrux
# Author: Aditi <aditi@ncrux.com>
#

#
# Generates golang file with key/value pairs in a map
#

export PKGNAME=`basename $2 | sed -e 's/.go$//g'`

awk -v pkg_name=$PKGNAME '
BEGIN {
	FS = "=";
	printf "package " pkg_name "\n//\n//\n// Automatically generated file using ncrux-config; DO NOT EDIT.\n//\n//\n";
	print "var Config = map[string]string {\n";
}

END {
	print "}\n";
}

# Ignore blank lines
/^$/ { next; }

# Ignore comments
/^#/ { next; }

# Split valid lines into two words: w1 and w2
{
	i = index($0, "=");
	w1 = substr($0, 1, i-1);
	w2 = substr($0, i+1);
}

# Perl File with key/value pairs in a hash
{
	if (w2 == "y") {
		print "\t\"" w1 "\": \"1\",";
	} else if(w2 == "m") {
		print "\t\"" w1 "_MODULE\": \"1\",";
	} else {
		# strip off double quotes around the string
		if(substr(w2,1,1) == "\"") {
			len = length(w2);
			w2 = substr(w2,2,len-2);
		}

		print "\t\"" w1 "\": \"" w2 "\",";
	}
	next;
}


' $1 > $2

exit 0
